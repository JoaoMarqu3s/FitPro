<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Alunos - FitPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap'); body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    {% include '_header.html' %}

    <div class="max-w-7xl mx-auto px-6 py-8">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="mb-4">
            {% for category, message in messages %}
            {% set bg_color = 'bg-green-100 border-green-400 text-green-700' if category == 'success' else 'bg-red-100 border-red-400 text-red-700' %}
            <div class="{{ bg_color }} border px-4 py-3 rounded relative" role="alert">
                <span class="block sm:inline">{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            {% include '_navigation.html' %}

            <div class="p-8">
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">Lista de Alunos</h2>
                            <p class="text-gray-600">Gerencie, edite ou remova alunos do sistema.</p>
                        </div>
                        <a href="{{ url_for('main.novo_aluno') }}" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors whitespace-nowrap">
                            + Adicionar Novo Aluno
                        </a>
                    </div>
                    <form method="GET" action="{{ url_for('main.lista_alunos') }}">
                        <div class="flex">
                            <input type="text" name="busca" class="w-full px-4 py-2 border border-gray-300 rounded-l-lg" placeholder="Pesquisar por nome ou CPF..." value="{{ termo_busca or '' }}">
                            <button type="submit" class="bg-gray-700 hover:bg-gray-800 text-white font-medium py-2 px-4 rounded-r-lg">Buscar</button>
                        </div>
                    </form>
                </div>
                
                <div class="flex justify-between items-center mb-4">
                    <div class="flex space-x-2">
                        <span class="text-sm font-medium text-gray-700 self-center">Ordenar por:</span>
                        {% set base_class = 'px-3 py-1 text-sm font-medium rounded-full' %}
                        {% set active_class = 'bg-blue-600 text-white' %}
                        {% set inactive_class = 'bg-gray-200 text-gray-700 hover:bg-gray-300' %}
                        
                        <a href="{{ url_for('main.lista_alunos', ordem='nome', busca=termo_busca) }}" class="{{ base_class }} {{ active_class if ordem_ativa == 'nome' else inactive_class }}">Nome</a>
                        <a href="{{ url_for('main.lista_alunos', ordem='recentes', busca=termo_busca) }}" class="{{ base_class }} {{ active_class if ordem_ativa == 'recentes' else inactive_class }}">Mais Recentes</a>
                        <a href="{{ url_for('main.lista_alunos', ordem='antigos', busca=termo_busca) }}" class="{{ base_class }} {{ active_class if ordem_ativa == 'antigos' else inactive_class }}">Mais Antigos</a>
                    </div>
                    <p class="text-sm text-gray-600">
                        Total: {{ alunos_paginados.total }} alunos
                    </p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase">Nome</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase">Data de Cadastro</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase">Contato</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase">Ações</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            {% for aluno in alunos_paginados.items %}
                            <tr>
                                <td class="px-6 py-4 text-sm text-gray-900">
                                    <a href="{{ url_for('main.aluno_detalhe', aluno_id=aluno.id) }}" class="font-medium text-blue-600 hover:underline">{{ aluno.nome }}</a>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-600">{{ aluno.data_cadastro | localtime }}</td>
                                <td class="px-6 py-4 text-sm text-gray-600">{{ aluno.email }}</td>
                                <td class="px-6 py-4 text-sm flex items-center space-x-2">
                                    <a href="{{ url_for('main.editar_aluno', aluno_id=aluno.id) }}" class="text-blue-600 hover:underline">Editar</a>
                                    <form method="POST" action="{{ url_for('main.excluir_aluno', aluno_id=aluno.id) }}" onsubmit="return confirm('Tem certeza?');">
                                        <button type="submit" class="text-red-600 hover:underline border-none bg-transparent p-0 cursor-pointer">Excluir</button>
                                    </form>
                                </td>
                            </tr>
                            {% else %}
                            <tr><td colspan="4" class="px-6 py-4 text-center text-gray-500">Nenhum aluno encontrado.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="mt-6 flex justify-between items-center">
                    <p class="text-sm text-gray-600">Página {{ alunos_paginados.page }} de {{ alunos_paginados.pages }}.</p>
                    <div class="flex items-center space-x-1">
                        <a href="{{ url_for('main.lista_alunos', page=alunos_paginados.prev_num, busca=termo_busca, ordem=ordem_ativa) if alunos_paginados.has_prev else '#' }}" class="{{ 'pointer-events-none opacity-50' if not alunos_paginados.has_prev }} px-3 py-2 border rounded-lg">Anterior</a>
                        {% for page_num in alunos_paginados.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                            {% if page_num %}<a href="{{ url_for('main.lista_alunos', page=page_num, busca=termo_busca, ordem=ordem_ativa) }}" class="{{ 'bg-blue-600 text-white' if page_num == alunos_paginados.page else 'bg-white' }} px-3 py-2 border rounded-lg">{{ page_num }}</a>
                            {% else %}<span class="px-3 py-2">...</span>{% endif %}
                        {% endfor %}
                        <a href="{{ url_for('main.lista_alunos', page=alunos_paginados.next_num, busca=termo_busca, ordem=ordem_ativa) if alunos_paginados.has_next else '#' }}" class="{{ 'pointer-events-none opacity-50' if not alunos_paginados.has_next }} px-3 py-2 border rounded-lg">Próximo</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>